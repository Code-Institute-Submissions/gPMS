
{% extends "base.html" %}
{% load bootstrap_tags %}
{% block content %}
{% load static %}

{{ latlng|json_script:"latlng-data" }}
{{ api_key|json_script:"api-key" }}
<script src="{% static 'js/reviews.js' %}"></script>

<!-- <script type="text/javascript" src="../static/js/maps.js"></script> -->

<div class="row map-banner">
    <div class="col-sm map-frame">
        <div id="map"></div>
    </div>
</div>
<div class="row listing-body">
    <div class="col-sm listing-frame">
        <ul>
            {% for ob in clinic %}
            <div class="profile-card">
                <h2>{{ ob.name }}</h2>
                <p>{{ ob.description }}</p>
                <h4>Available Therapies</h4>
                {% for m in mods %}
                <li>{{ m }}</li> 
                {% endfor %}
                <h4>Contact</h4>
                <p>
                    {% if ob.web %}
                    Web: <a  href="{{ ob.web }}" target="_blank">{{ ob.name }}</a><br>
                    {% endif %}
                    Phone: {{ ob.phone }}<br>
                    Email: {{ ob.practitioner }}<br>
                    Address: {{ ob.street }} {{ ob.city }}
                </p>
            </div>
            {% endfor %}
        </ul>
        <hr>
    </div>
</div>
<div class="row reviews">
    <div class="col-sm review-form">
        {% if edit %}
        {% for r in reviews %}
        {% if r.author == user %}
        <form method="POST" action="{% url 'edit_review' review_id=r.id %}">
            {% endif %}
        {% endfor %}
        {% else %}    
        <form method="POST" action="create_review/">
        {% endif %}    
            {% csrf_token %}
            <fieldset class="form-group">
                {% for ob in clinic %}
                <legend>Leave a review for {{ ob.name }}</legend>
                {% endfor %}
                {{ form | as_bootstrap}}
                {% if edit %}
                <button type="submit" class="btn btn-primary">Update</button>
                {% else %}
                <button type="submit" class="btn btn-primary">Save</button>
                {% endif %}
            </fieldset>
        </form>
    </div>

    <div class="col-sm review-frame">
        {% if not reviews %}
        <p>There are no reviews yet.</p>
        <p>You could be the first!</p>
        {% endif %}

        {% for r in reviews %}
        <div class="review-slip col-sm">
            <div>
                <h5 class="review-title">{{ r.title }}</h5> 
                {% if r.author == user %}
                <button class="btn-small btn-danger"><a href="{% url 'delete_review' review_id=r.id %}">Delete</a></button>
                <button class="btn-small btn-primary"><a href="{% url 'edit_review' review_id=r.id %}">Edit</a></button> 
            </div>
            {% endif %}
            <div>
                <p>{{ r.body }}</p>
            </div>
        </div>
        <hr>
        {% endfor %}
    </div>
</div>

{% endblock %}
